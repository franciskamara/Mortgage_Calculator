@page "/counter"
@using Mortgage_Calculator

<PageTitle>Mortgage Calculator</PageTitle>

<h2>Mortgage Calculator</h2>
<nav>
    <div class="topnav">
        <a class="active" @onclick="() => calcOption = 1">Calculate mortgage</a>
        &nbsp
        <a class="active" @onclick="() => calcOption = 2">Compare mortgages</a>
    </div>
    <br />
</nav>
@if (calcOption == 1)
{
    <div title="Single mortgage form">
        <h5>Single mortgage</h5>
        <br />

        <label>Loan amount: </label>
        <InputNumber @bind-Value="userInput.Amount"></InputNumber>
        <br /><br />
        <label>How many years for the loan? </label>
        <InputNumber @bind-Value="userInput.Term"></InputNumber>
        <br /><br />

        <MortgageTypeSelect @bind-selection="mTypeSelect"></MortgageTypeSelect>

        <br /><br />
        <label>Interest rate: %</label>
        <InputNumber @bind-Value="userInput.InterestRatePercentage"></InputNumber>
        <br /><br />
        <label>Deposit (optional):</label>
        <InputNumber @bind-Value="userInput.Deposit"></InputNumber>
        <br /><br />

        <button class="btn btn-primary" @onclick="DisplayResults">Results</button>
    </div>

    <div title="Results display">
        @if (resultSet?.PaymentItems?.Count > 0)//Results output
        {
            <br />
            <h5>Mortgage Calculation Results</h5>// Header: Mortgage Calculation results

            <div><LineChartOutput resultSet="resultSet"></LineChartOutput></div>// Line chart output

            // Total repayment, capital and interest only values
            <font style="margin-bottom:0" size="-1" title="Total Repayment Amount">
                Total Repayment Amount: £@resultSet.TotalAmount.ToString("N2")
            </font>// Total repayment amount
            <br />
            double principle = userInput.Amount - userInput.Deposit;// Capital repayment display
            <font size="0" style="margin-top:-1" title="Capital repayment value">
                The capital repayment is £@principle.ToString("N2")
            </font>// Display capital repayment amount
            <br />
            double interestRepaymentTotal = resultSet.TotalAmount - principle;
            <font style="margin-top:-1" size="0" title="Interest repayment value">
                The Interest rate repayment is £@interestRepaymentTotal.ToString("N2");
            </font>// Display Interest rate value

            <br />
            <font size="-1">Monthly Repayment Amount: £@resultSet.MonthlyRepayments[0].ToString("N2") </font>//Display one month's repayment value

            <br />
            if (resultSet.MonthlyRepayments != null && resultSet.MonthlyRepayments.Count > 0)
            {
                <font size="-1">Total Repayment Months: @resultSet.MonthlyRepayments.Count</font>
            }
            else
            {
                <font size="-1">
                    0 months</font">
                }

                <details>
                    <summary title="List of annual remaining repayments">
                        <font size="-1">Remaining amount at end of each year:</font>
                    </summary>
                    <ul>
                        @foreach (PaymentItem item in resultSet.PaymentItems)
                        {
                            if (item.Date.Month == 12)//Check if the month is December
                            {
                                <li>@item.Date.ToString("MM/yyyy") - £@item.RemainingAmount.ToString("N2")</li>
                            }
                        }
                    </ul>
                </details>
                <br />

                <div style="border: 4px solid yellow; padding: 4px;">
                    <br />
                    <p>Warning: @resultSet.WarningIndicator</p>
                </div>
            }
</div>

}

@if (calcOption == 2)
{
    <div title="Comparison mortgages form">
        <h5>Compare mortgages</h5>
        <br /><br />
        <h6>First mortgage</h6>

        <label>Loan amount: </label>
        <InputNumber @bind-Value="userInput.Amount"></InputNumber>
        <br /><br />
        <label>How many years for the loan? </label>
        <InputNumber @bind-Value="userInput.Term"></InputNumber>
        <br /><br />

        <MortgageTypeSelect selection="mTypeSelect"></MortgageTypeSelect>

        <br /><br />
        <label>Interest rate: %</label>
        <InputNumber @bind-Value="userInput.InterestRatePercentage"></InputNumber>
        <br /><br />
        <label>Deposit (optional):</label>
        <InputNumber @bind-Value="userInput.Deposit"></InputNumber>
        <br /><br />

        <h6>Second mortgage</h6>

        <label>Loan amount: </label>
        <InputNumber @bind-Value="userInputCompare.Amount"></InputNumber>
        <br /><br />
        <label>How many years for the loan? </label>
        <InputNumber @bind-Value="userInputCompare.Term"></InputNumber>
        <br /><br />

        <MortgageTypeSelect selection="mTypeSelectCompare"></MortgageTypeSelect>

        <br /><br />
        <label>Interest rate: %</label>
        <InputNumber @bind-Value="userInputCompare.InterestRatePercentage"></InputNumber>
        <br /><br />
        <label>Deposit (optional):</label>
        <InputNumber @bind-Value="userInputCompare.Deposit"></InputNumber>
        <br /><br />

        <button class="btn btn-primary" @onclick="DisplayResults">Results</button>
    </div>

    <div title="Results display">
        @if (resultSet?.PaymentItems?.Count > 0)//First results output
        {
            <br />
            <h6>First mortgage results</h6>

            <p title="Total repayment amount">Total amount:  £@resultSet.TotalAmount.ToString("N2")</p>//Total Amount

            <p>Monthly repayment amount: £@resultSet.MonthlyRepayments[0].ToString("N2") </p>//Display one month's repayment value

            if (resultSet.MonthlyRepayments != null && resultSet.MonthlyRepayments.Count > 0)//Total repaymnet months
            {
                <p>Total repayment months: @resultSet.MonthlyRepayments.Count</p>
            }
            else
            {
                <p>0 months</p>
            }

            <details>
                <summary title="List of annual remaining repayments">
                    Remaining amount:
                </summary>
                <ul>
                    @foreach (PaymentItem item in resultSet.PaymentItems)
                    {
                        if (item.Date.Month == 12)//Check if the month is December
                        {
                            <li>@item.Date.ToString("MM/yyyy") - £@item.RemainingAmount.ToString("N2")</li>
                        }
                    }
                </ul>
            </details>
            <br />

            <div style="border: 4px solid yellow; padding: 4px;">
                <br />
                <p>Warning: @resultSet.WarningIndicator</p>
            </div>
        }

        <br />
        @if (resultSetCompare?.PaymentItems?.Count > 0)//Second results output

        {
            <h6>Second mortgage results</h6>

            <p title="Total repayment amount">Total amount:  £@resultSetCompare.TotalAmount.ToString("N2")</p>

            <p>Monthly repayment amount: £@resultSet.MonthlyRepayments[0].ToString("N2") </p>//Display one month's repayment value

            if (resultSetCompare.MonthlyRepayments != null && resultSetCompare.MonthlyRepayments.Count > 0)
            {
                <p>Total repayment months: @resultSetCompare.MonthlyRepayments.Count</p>
            }
            else
            {
                <p>0 months</p>
            }

            <details>
                <summary title="List of annual remaining repayments">
                    Remaining amount:
                </summary>
                <ul>
                    @foreach (PaymentItem item in resultSetCompare.PaymentItems)
                    {
                        if (item.Date.Month == 12)//Check if the month is December
                        {
                            <li>@item.Date.ToString("MM/yyyy") - £@item.RemainingAmount.ToString("N2")</li>

                        }
                    }
                </ul>
            </details>
            <br />

            <div style="border: 4px solid yellow; padding: 4px;">
                <br />
                <p>Warning: @resultSetCompare.WarningIndicator</p>
            </div>
        }
    </div>
}

@code
{

    private int calcOption = 0;
    private UserInput userInput = new();
    private UserInput userInputCompare = new();
    private MortgageType mTypeSelect = MortgageType.Standard;
    private MortgageType mTypeSelectCompare = MortgageType.Standard;
    private Results resultSet = new();
    private Results resultSetCompare = new();
    private Graph graph = new();

    private void DisplayResults()
    {
        if (calcOption == 1)
        {
            //do calc 1
            resultSet = LogicMethod.CalculateRepayments(userInput, mTypeSelect);
        }
        else
        {
            //do calc 2
            resultSet = LogicMethod.CalculateRepayments(userInput, mTypeSelect);
            resultSetCompare = LogicMethod.CalculateRepayments(userInputCompare, mTypeSelectCompare);
        }
    }
}

